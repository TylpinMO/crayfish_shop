<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Admin Panel - –†–∞–∫–æ–ú–∞—Ä–∫–µ—Ç</title>
		<link rel="stylesheet" href="../styles.css" />
		<link rel="stylesheet" href="admin-styles.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
		/>
	</head>
	<body class="admin-body">
		<!-- Loading Screen -->
		<div class="loading-screen" id="loading-screen">
			<div class="loading-content">
				<div class="loading-shrimp">
					<i class="fas fa-cog fa-spin"></i>
				</div>
				<div class="loading-text">
					<h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
					<p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è...</p>
				</div>
			</div>
		</div>

		<!-- Login Form (shown when not authenticated) -->
		<div class="login-container" id="login-container">
			<div class="login-form">
				<div class="login-header">
					<i class="fas fa-shield-alt"></i>
					<h2>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
					<p>–†–∞–∫–æ–ú–∞—Ä–∫–µ—Ç - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
				</div>
				<form id="login-form">
					<div class="form-group">
						<label for="email">Email</label>
						<input type="email" id="email" name="email" required />
					</div>
					<div class="form-group">
						<label for="password">–ü–∞—Ä–æ–ª—å</label>
						<input type="password" id="password" name="password" required />
					</div>
					<button type="submit" class="btn-login">
						<i class="fas fa-sign-in-alt"></i>
						–í–æ–π—Ç–∏
					</button>
				</form>
				<div class="login-footer">
					<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
				</div>
			</div>
		</div>

		<!-- Admin Dashboard (shown when authenticated) -->
		<div class="admin-container" id="admin-container" style="display: none">
			<!-- Sidebar Navigation -->
			<aside class="admin-sidebar">
				<div class="sidebar-header">
					<i class="fas fa-shrimp"></i>
					<span>–†–∞–∫–æ–ú–∞—Ä–∫–µ—Ç</span>
					<small>Admin Panel</small>
				</div>

				<nav class="sidebar-nav">
					<a href="#dashboard" class="nav-item active" data-page="dashboard">
						<i class="fas fa-chart-pie"></i>
						<span>Dashboard</span>
					</a>
					<a href="#products" class="nav-item" data-page="products">
						<i class="fas fa-fish"></i>
						<span>–¢–æ–≤–∞—Ä—ã</span>
						<span class="nav-badge" id="products-count">0</span>
					</a>
					<a href="#categories" class="nav-item" data-page="categories">
						<i class="fas fa-tags"></i>
						<span>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
					</a>
					<a href="#orders" class="nav-item" data-page="orders">
						<i class="fas fa-shopping-cart"></i>
						<span>–ó–∞–∫–∞–∑—ã</span>
						<span class="nav-badge new-orders" id="orders-count">0</span>
					</a>
					<a href="#settings" class="nav-item" data-page="settings">
						<i class="fas fa-cog"></i>
						<span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
					</a>
				</nav>

				<div class="sidebar-footer">
					<div class="user-info">
						<i class="fas fa-user-circle"></i>
						<span id="current-user">Admin</span>
					</div>
					<button class="btn-logout" id="logout-btn">
						<i class="fas fa-sign-out-alt"></i>
						–í—ã–π—Ç–∏
					</button>
				</div>
			</aside>

			<!-- Main Content Area -->
			<main class="admin-main">
				<!-- Header -->
				<header class="admin-header">
					<div class="header-left">
						<button class="sidebar-toggle" id="sidebar-toggle">
							<i class="fas fa-bars"></i>
						</button>
						<h1 id="page-title">Dashboard</h1>
					</div>
					<div class="header-right">
						<div class="header-stats">
							<div class="stat-item">
								<i class="fas fa-shopping-cart"></i>
								<span
									>–ù–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤: <strong id="new-orders-count">0</strong></span
								>
							</div>
							<div class="stat-item">
								<i class="fas fa-fish"></i>
								<span
									>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:
									<strong id="total-products-count">0</strong></span
								>
							</div>
							<div class="stat-item">
								<i class="fas fa-exclamation-triangle"></i>
								<span
									>–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è: <strong id="low-stock-count">0</strong></span
								>
							</div>
						</div>
					</div>
				</header>

				<!-- Page Content Container -->
				<div class="page-content" id="page-content">
					<!-- Content will be loaded dynamically -->
				</div>
			</main>
		</div>

		<!-- Notifications Container -->
		<div id="notifications-container"></div>

		<!-- No Supabase on client - using secure API! -->
		<!-- Admin Scripts -->
		<script src="client-api.js"></script>
		<script src="client-auth.js"></script>
		<script src="supabase-uploader.js"></script>
		<script src="admin-ui.js"></script>
		<script src="product-manager.js"></script>

		<!-- Initialize Admin Panel -->
		<script>
			document.addEventListener('DOMContentLoaded', async () => {
				try {
					console.log('üîê Initializing Fish Shop Admin Panel...')

					// Initialize API first
					window.adminAPI = new AdminAPI()
					console.log('üì° AdminAPI initialized')

					// Then Auth (depends on API)
					window.adminAuth = new AdminAuth()
					console.log('üîê AdminAuth initialized')

					// Finally UI (depends on Auth)
					window.adminUI = new AdminUI()
					console.log('üé® AdminUI initialized')

					// Initialize ProductManager
					window.productManager = new ProductManager(window.adminUI)
					console.log('üì¶ ProductManager initialized')

					// Setup form handlers
					setupFormHandlers()

					// Setup global handlers
					setupGlobalErrorHandling()
					setupKeyboardShortcuts()

					console.log('‚úÖ All admin components initialized successfully!')
				} catch (error) {
					console.error('‚ùå Failed to initialize admin panel:', error)
				}
			})

			function setupFormHandlers() {
				// Login form
				const loginForm = document.getElementById('login-form')
				if (loginForm) {
					loginForm.addEventListener('submit', async e => {
						e.preventDefault()

						const email = document.getElementById('email').value
						const password = document.getElementById('password').value

						const loginBtn = loginForm.querySelector('.btn-login')
						const originalText = loginBtn.innerHTML

						loginBtn.innerHTML =
							'<i class="fas fa-spinner fa-spin"></i> –í—Ö–æ–¥...'
						loginBtn.disabled = true

						const result = await window.adminAuth.login(email, password)

						loginBtn.innerHTML = originalText
						loginBtn.disabled = false

						if (!result.success) {
							console.error('Login failed:', result.error)
						}
					})
				}

				// Logout button
				const logoutBtn = document.getElementById('logout-btn')
				if (logoutBtn) {
					logoutBtn.addEventListener('click', () => {
						window.adminAuth.logout()
					})
				}

				// Mobile sidebar toggle
				const sidebarToggle = document.getElementById('sidebar-toggle')
				const sidebar = document.querySelector('.admin-sidebar')

				console.log('üçî Setting up sidebar toggle:', {
					toggle: !!sidebarToggle,
					sidebar: !!sidebar,
					sidebarClasses: sidebar?.className,
				})

				if (sidebarToggle && sidebar) {
					sidebarToggle.addEventListener('click', e => {
						e.preventDefault()
						e.stopPropagation()

						console.log('üçî Sidebar toggle clicked! Before:', sidebar.className)
						sidebar.classList.toggle('mobile-open')
						console.log('üçî Sidebar toggle clicked! After:', sidebar.className)
						console.log(
							'üì± Sidebar is now:',
							sidebar.classList.contains('mobile-open') ? 'OPEN' : 'CLOSED'
						)
					})

					// Close sidebar when clicking outside on mobile
					document.addEventListener('click', e => {
						if (
							window.innerWidth <= 768 &&
							!sidebar.contains(e.target) &&
							!sidebarToggle.contains(e.target) &&
							sidebar.classList.contains('mobile-open')
						) {
							sidebar.classList.remove('mobile-open')
						}
					})
				}
			}

			function setupGlobalErrorHandling() {
				window.addEventListener('unhandledrejection', event => {
					console.error('Unhandled promise rejection:', event.reason)
					if (window.adminAuth) {
						window.adminAuth.showNotification(
							'–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.',
							'error'
						)
					}
				})

				window.addEventListener('error', event => {
					console.error('JavaScript error:', event.error)
				})
			}

			function setupKeyboardShortcuts() {
				document.addEventListener('keydown', e => {
					if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
						e.preventDefault()
						console.log('Quick navigation shortcut pressed')
					}

					if (e.key === 'Escape') {
						const modals = document.querySelectorAll(
							'.modal.show, .dropdown.open'
						)
						modals.forEach(modal => {
							modal.classList.remove('show', 'open')
						})
					}
				})
			}
		</script>
	</body>
</html>
